var App=React.createClass({displayName:"App",getInitialState:function(){return{currentUser:{},translations:{},commentsData:{comments:[],pagenum:0,total:0,current_page:1}}},getUserInfo:function(){yuanjs.ajax({type:"GET",url:"index.php?controller=user&action=getUserInfo",dataType:"json",cache:!1,dataType:"json",success:function(a){console.log("user info:",a),this.setState({currentUser:a}),this.loadCommentsFromServer()}.bind(this),error:function(){}.bind(this)})},getAppConfig:function(a){yuanjs.ajax({type:"GET",url:"index.php",data:{action:"getSysJSON",t:Date.now()},dataType:"json",cache:!1,dataType:"json",success:a.bind(this),error:function(){}.bind(this)})},loadCommentsFromServer:function(){yuanjs.ajax({url:this.props.url,dataType:"json",method:"GET",cache:!1,data:{ajax:!0,pid:1},success:function(a){this.setState({commentsData:{comments:a.messages,pagenum:a.pagenum,total:a.total,current_page:a.current_page}})}.bind(this),error:function(a,b,c){}.bind(this)})},componentDidMount:function(){this.getAppConfig(function(a){this.setState({translations:a});var b=Cookies.get("PHPSESSID");b&&this.getUserInfo(b)})},render:function(){return React.createElement("div",{id:"appbox"},React.createElement(Header,{user:this.state.currentUser}),React.createElement(CommentBox,{url:"index.php",lang:this.state.translations,comments:this.state.commentsData}),React.createElement(SearchBar,null))}}),Header=React.createClass({displayName:"Header",render:function(){var a;return a=this.props.user.admin||this.props.user.user?React.createElement(LogoutButton,null):React.createElement(LoginButton,null),React.createElement("div",{className:"header"},a)}}),LogoutButton=React.createClass({displayName:"LogoutButton",render:function(){return React.createElement("a",{href:"index.php?controller=user&action=logout"},"LOGOUT")}}),LoginButton=React.createClass({displayName:"LoginButton",render:function(){return React.createElement("div",null,React.createElement("a",{href:"index.php?controller=user&action=create&width=630&height=45%"},"REGISTER"),React.createElement("a",{href:"index.php?controller=user&action=login"},"LOGIN"))}}),SearchBar=React.createClass({displayName:"SearchBar",render:function(){return React.createElement("div",{className:"searchbar"},"This is a search bar.")}}),CommentBox=React.createClass({displayName:"CommentBox",handleCommentSubmit:function(a){a.ajax=!0,yuanjs.ajax({type:"POST",url:"./index.php?controller=post&action=create",data:a,success:function(a){}.bind(this),error:function(a,b,c){}.bind(this)})},render:function(){return React.createElement("div",{className:"commentBox"},React.createElement("h1",null,"Welcome"),React.createElement(CommentStatistics,{lang:this.props.lang,current_page:this.props.comments.current_page,total:this.props.comments.total,pagenum:this.props.comments.pagenum}),React.createElement(CommentList,{data:this.props.comments.comments}),React.createElement(CommentForm,{onCommentSubmit:this.handleCommentSubmit}))}}),CommentStatistics=React.createClass({displayName:"CommentStatistics",rawMarkup:function(){var a=this.props.lang.PAGE_NAV,b=a?a.replace("{num_of_post}",this.props.total).replace("{num_of_page}",this.props.pagenum):"";return{__html:b}},render:function(){return React.createElement("div",{className:"statistics"},React.createElement("p",{dangerouslySetInnerHTML:this.rawMarkup()}))}}),CommentList=React.createClass({displayName:"CommentList",render:function(){var a=this.props.data.map(function(a){return React.createElement(Comment,{author:a.uname,key:a.id,time:a.time},a.post_content)});return React.createElement("div",{className:"commentList"},a)}}),Comment=React.createClass({displayName:"Comment",rawMarkup:function(){return{__html:this.props.children.toString()}},render:function(){return React.createElement("div",{className:"comment"},React.createElement("span",{className:"commentAuthor"},this.props.author),React.createElement("span",{className:"commentDate"},this.props.time),React.createElement("div",{className:"commentText",dangerouslySetInnerHTML:this.rawMarkup()}))}}),CommentForm=React.createClass({displayName:"CommentForm",handleSubmit:function(a){a.preventDefault();var b=this.refs.user.value.trim(),c=this.refs.content.value.trim();return b&&c?(this.props.onCommentSubmit({user:b,content:c}),this.refs.user.value="",this.refs.content.value="",!1):void 0},render:function(){return React.createElement("form",{onSubmit:this.handleSubmit,className:"commentForm"},React.createElement("input",{ref:"user",type:"text",placeholder:"Your name"}),React.createElement("input",{ref:"content",type:"text",placeholder:"Say something.."}),React.createElement("input",{type:"submit",value:"Post"}))}});ReactDOM.render(React.createElement(App,{url:"index.php"}),document.getElementById("content"));
//# sourceMappingURL=index.js.map